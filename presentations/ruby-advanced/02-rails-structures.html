<!DOCTYPE html><html lang="fr"><head><title>Formation Ruby on Rails Avancé - Structurer son application - Cécile Veneziani</title><meta charset="utf-8" /><meta content="noindex,nofollow" name="robots" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/assets/images/favicon.ico" rel="icon" type="image/ico" /><link href="/assets/stylesheets/presentation.css" rel="stylesheet" type="text/css" /></head><body class="presentations presentations_ruby-advanced presentations_ruby-advanced_02-rails-structures"><div class="reveal"><div class="slides"><section data-markdown="" data-separator="^---" data-separator-vertical="^--"><script type="text/template"># Structurer son app
## Jour 2

---

## Topics

* Structure type (The Rails Way)
* Structure avancée (The Rails Haters)

---

## Structure type

--

## Structure type (1)

* Modèles
* Vues
* Contrôlleurs
* Helpers
* Lib

--

## Structure type (2)

### Modèles

* Persistence
* Validations
* Requêtes
* Domaine

--

## Structure type (3)

### Vues

* Gestion du rendu (HTML, JSON, etc.)
* Accompagnée de logique (souvent)

--

## Structure type (4)

### Contrôlleurs

* Gestion requête web
* Interface avec les modèles
* Accompagné de comportements du domaine (souvent)

--

## Structure type (5)

### Helpers

* Extraction de la logique des vues
* Modules au contenu non structuré

### Lib

* Modules externes au domaine

--

## Structure type (6)

### The Rails Way... to a dirty code

On retrouve de la logique **propre au domaine** à travers toutes les couches : modèles, vues, contrôlleurs.

---

## Structure avancée

--

## Structure avancée (1)

### Single Responsibility Principle (SRP)

> "A class should have only one reason to change"
> Robert C. Martin

--

## Structure avancée (2)

### Single Responsibility Principle (SRP)

* Meilleure structure de code
* Faible couplage & Plus robuste
* Maintenabilité & Refactoring
* Testabilité & Debug

*Source: article d'[Eyal Golan](http://eyalgo.com/2014/02/01/the-single-responsibility-principle/)*

--

## Structure avancée (3)

Quels composants vont nous permettre d'obtenir une application respectant le SRP ?

--

## Structure avancée (4)

* Décorateurs
* Présenteurs
* Formulaires
* Contrats
* Services
* Polices

--

## Structure avancée (5)

### Décorateurs

Un décorateur vient ajouter UNE nouvelle fonctionnalité à un modèle.

On dit qu'il vient `étendre` une classe. Dans un environnement Ruby on Rails, un décorateur peut être comparé à un `Concern`.

--

## Structure avancée (6)

### Présenteurs

Un présenteur vient ajouter une fonctionnalité de **présentation** à un modèle.

On peut considérer un présenteur comme étant un décorateur de présentation.

--

## Structure avancée (7)

### Décorateurs vs Présenteurs (1)

#### Attention

Dans la plupart des cas, l'usage de décorateur est à PROSCRIRE lorsqu'il s'agit d'ajouter une fonctionnalité qui **relève du domaine**.

Il est conseillé d'utiliser des décorateurs pour enrichir des vues et en extraire la logique. Cela revient à employer le décorateur comme un présenteur.

--

## Structure avancée (8)

### Décorateurs vs Présenteurs (2)

#### Aller plus loin

Une gem est disponible : [Draper](https://github.com/drapergem/draper)

Dans certains cas, son utilisation peut être 'overkill' comparativement à un présenteur maison.

Un bon article sur le sujet : [Decorators Compared To Strategies, Composites, and Presenters](http://robots.thoughtbot.com/decorators-compared-to-strategies-composites-and)

--

## Structure avancée (9)

### Formulaires (1)

Un formulaire encapsule les champs d'un modèle et a ses propres règles de validation.

Il permet de découpler la vue du modèle (persistence) et d'extraire les validations du modèle.

--

## Structure avancée (10)

### Formulaires (2)

Une gem est disponible : [Reform](https://github.com/apotonick/reform)

#### Les plus

* Agnostique niveau framework & ORM
* S'interface avec form_for, simple_form, etc.

--

## Structure avancée (11)

### Contrats (1)

Un contrat porte les validations d'un modèle.

Il permet d'extraire les validations du modèle (persistence).

--

## Structure avancée (12)

### Contrats (2)

Une gem est disponible : [Reform](https://github.com/apotonick/reform) (oui, la même)

--

## Structure avancée (13)

### Services

Un service ajoute UNE opération basée sur un modèle.

A l'inverse du décorateur, le service utilise un modèle mais ne vient pas l'enrichir.

--

## Structure avancée (14)

### Polices (1)

Une police permet de déterminer si une/des opérations peut/peuvent être réalisée(s).

--

## Structure avancée (15)

### Polices (2)

Une gem est disponible : [Pundit](https://github.com/elabs/pundit)

Dans certains cas, son utilisation peut être 'overkill' comparativement à une police maison.

---

## Connexion (1)

### Le contrôlleur

* instancie un modèle
* instancie un formulaire avec le modèle
* instancie un service avec le formulaire / le modèle

--

## Connexion (2)

### La vue / le décorateur / le présenteur

* intéragit uniquement avec le formulaire / le modèle

--

## Connexion (3)

### Le service

* intéragit avec une police / un contrat
* intéragit avec le formulaire / le modèle

### La police

* se base sur le modèle / un contrat

---

## Aller plus loin

### Référence

[7 Patterns to Refactor Fat ActiveRecord Models](http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/)

---

## Happy Hacking!</script></section></div><footer><div class="row footer--terms"><div class="small-12 columns"><p><a href="http://cecilitse.org/fr/">Cecilitse</a>- Pubilé sous <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA </a><span class="print-link">- Export <a href="?print-pdf">PDF </a></span></p></div></div><div class="banner"></div></footer></div><script src="/assets/javascripts/presentation.js" type="text/javascript"></script></body></html>